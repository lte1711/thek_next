# 팀 워크플로우 규칙 (Team Workflow Rules)

**버전**: 1.0  
**확정일**: 2026-01-20  
**적용 범위**: thek_next 프로젝트 전체

---

## 0. 핵심 원칙

### 증거 기반 원칙 (Evidence-Only Principle)
- 모든 판단/정리는 **실제 코드/DB 증거**에 기반한다
- 추정/가정은 명시적으로 표시하고, 증거로 검증 후 확정한다
- "아마도", "것 같다"는 금지. "파일명:라인" 근거를 제시한다

### 분석→문서→합의→실행 원칙
```
1. 분석 (재미니/설탕이)
   ↓
2. 문서화 (설탕이)
   ↓
3. 통합 검토 (백설이)
   ↓
4. 티켓 발행 (백설이)
   ↓
5. 실행 (허니)
   ↓
6. 검수 (재미니/설탕이)
```

**절대 금지**: 분석 없이 즉흥 수정, 티켓 없는 코드 변경

---

## 1. 역할 정의

| AI | 도구 | 주 역할 | 금지 사항 |
|---|---|---|---|
| **백설이** | ChatGPT | 총괄 기획/통합/티켓 발행 | 단독 코드 수정 |
| **허니** | Git Bash + VS Code | 실행/증거 수집/커밋 | **티켓 없는 수정**<br>**Country 수정** |
| **재미니** | Gemini | DB/스키마/리스크 분석 | 직접 코드 반영 |
| **설탕이** | Claude | 문서화/리뷰/구조 설계 | 직접 코드 반영 |

---

## 2. Country 영역 동결 규칙 (최우선)

### 동결 범위
```
/_branches/jp/ 내:
- country_*.php (모든 파일)
- ok_save.php
- reject_save.php
- reject_reset.php
- reject_restore.php
```

### 동결 사유
- 2026-01-20 기준 Country Ready/Completed 기능 안정화 완료
- OK/Reject 버튼 DB 액션 수정 완료
- tx_id=NULL fallback 로직 구현 완료
- Japan region updated_at 컬럼 추가 완료

### 예외 조건
**오직 다음 경우에만** 백설이 승인 하에 수정 가능:
1. 시스템 전체를 멈추는 치명적 에러 발생
2. 데이터 손실/무결성 위반 발생
3. 보안 취약점 발견

**일반적인 개선/리팩토링은 금지**

---

## 3. 허니(실행자) 작업 규칙

### ✅ 허니가 할 수 있는 것
- 파일 검색 (grep, find, ls)
- 파일 내용 읽기 (cat, head, tail)
- DB 조회 (SELECT 쿼리만)
- **티켓에 명시된 작업만 실행**
- 커밋/푸시/서버 배포

### ❌ 허니가 하지 말아야 할 것
- **티켓 없는 코드 수정**
- **Country 관련 파일 수정** (동결)
- 즉흥적인 "이게 더 나을 것 같아서" 변경
- DB INSERT/UPDATE/DELETE (티켓 없이)
- 분석/판단 (다른 AI가 제공)

### 허니 티켓 포맷 (필수)
```markdown
## [TICKET-XXX] 제목

**목적**: (1줄 요약)

**변경 파일**:
- file1.php (Line 10-20: 변경 내용)
- file2.php (Line 50: 추가)

**변경 내용**:
```언어
// BEFORE
old code

// AFTER
new code
```

**금지 영역**: 
- Country 관련 파일 (동결)
- (기타 금지 영역)

**완료 기준**:
- [ ] 코드 반영
- [ ] 로컬 테스트
- [ ] 커밋 (메시지 규칙 준수)
- [ ] 서버 배포
- [ ] 동작 확인 (URL/쿼리)
```

### HONEY_LOG 표준 포맷
```
[HONEY_LOG] 작업명 - 상태
예:
[HONEY_LOG] TICKET-001 시작
[HONEY_LOG] TICKET-001 완료 - Commit a1b2c3d
[HONEY_LOG] 증거 수집 완료 - 45개 파일 발견
```

---

## 4. 문서 관리 규칙

### 문서 저장 위치
```
docs/
├── policies/          # 정책/규칙 문서
│   ├── TEAM_WORKFLOW_RULES.md
│   └── ...
├── evidence/          # 증거 패키지
│   ├── PHASE-1-A_EVIDENCE_PACK.md
│   └── ...
├── tickets/           # 작업 티켓
│   ├── TICKET-001_settle_chk2_definition.md
│   └── ...
├── analysis/          # 분석 보고서
│   ├── STATE_FLAG_SYSTEM_DEFINITION.md
│   └── ...
└── schemas/           # DB 스키마/템플릿
    ├── DATABASE_SCHEMA_TEMPLATE.md
    └── new_country_setup.sql
```

### 문서 작성 규칙
1. **증거 기반**: 코드 라인/쿼리 결과를 직접 포함
2. **file:// 링크 금지**: 실제 내용을 문서에 포함
3. **버전/날짜 명시**: 언제 작성되었는지 표시
4. **변경 이력**: 수정 시 변경 이력 기록

---

## 5. 커밋 메시지 규칙

### 포맷
```
<type>: <subject>

<body>
```

### Type 분류
- `feat`: 새 기능 추가
- `fix`: 버그 수정
- `docs`: 문서만 변경
- `refactor`: 리팩토링 (기능 변경 없음)
- `test`: 테스트 추가/수정
- `chore`: 빌드/설정 변경

### 예시
```
docs: add workflow rules and Phase-1-A evidence pack

- Add TEAM_WORKFLOW_RULES.md with Country freeze policy
- Add PHASE-1-A_EVIDENCE_PACK.md with code evidence
- Add TICKET-001 for settle_chk=2 definition
```

---

## 6. 작업 단계별 체크리스트

### Phase 1: 분석 (병렬)
- [ ] 백설이: 분석 영역 지정
- [ ] 허니: 증거 수집 (grep/파일목록/DB 조회)
- [ ] 재미니: DB 스키마/리스크 분석
- [ ] 설탕이: 코드 구조/패턴 분석

### Phase 2: 문서화
- [ ] 설탕이: 분석 결과 문서화
- [ ] 백설이: 통합 검토 + 우선순위 분류 (P1/P2/P3)
- [ ] 문서를 docs/ 하위에 커밋

### Phase 3: 방향성 합의
- [ ] 옵션 제시 (A/B/C/D 등)
- [ ] 리스크/영향 평가
- [ ] 사용자 승인 대기

### Phase 4: 티켓 발행
- [ ] 백설이: 작업 티켓 작성
- [ ] 변경 범위 명시
- [ ] 완료 기준 명확화
- [ ] docs/tickets/ 에 저장

### Phase 5: 실행
- [ ] 허니: 티켓 기반 코드 수정
- [ ] 로컬 테스트
- [ ] 커밋 (규칙 준수)
- [ ] 서버 배포

### Phase 6: 검수
- [ ] 재미니: DB 무결성 확인
- [ ] 설탕이: 코드 리뷰
- [ ] 백설이: 최종 승인

---

## 7. 에스컬레이션 규칙

### 의견 충돌 시
1. 재미니(DB 관점) vs 설탕이(코드 관점) → **백설이가 중재**
2. 백설이 판단 불가 → **사용자에게 보고**

### 긴급 상황
1. 서버 다운/데이터 손실 → 즉시 사용자에게 보고
2. Country 영역 에러 → 백설이 승인 대기 (즉시 수정 금지)

---

## 8. 금지 행위 (Zero Tolerance)

다음 행위는 **절대 금지**:
1. ❌ 티켓 없는 코드 수정 (허니)
2. ❌ Country 관련 파일 수정 (특별 승인 없이)
3. ❌ 증거 없는 추정 기반 결정
4. ❌ 문서화 없는 분석 종료
5. ❌ 커밋 메시지 규칙 위반
6. ❌ 직접 프로덕션 DB 수정 (백업 없이)

---

## 9. 이 문서의 변경

이 문서 자체를 변경하려면:
1. 백설이가 변경안 제시
2. 사용자 승인 필수
3. 버전 번호 증가
4. 변경 이력 기록

---

**최종 승인**: 사용자 (2026-01-20)
**다음 리뷰 예정**: 필요 시
