# 📌 프로젝트 진행 원칙 및 다음 단계 계획 (초안)

## 0. 확정 사항 (고정 규칙)

* **Country 관련 영역**

  * 앞으로 **특별한 추가 지시가 있기 전까지 일절 수정하지 않음**
  * UI / 로직 / DB / 언어 처리 모두 포함
  * 단, *에러로 인해 전체 시스템에 영향*을 주는 경우만 예외적으로 보고 후 처리

---

## 1. 다음 단계의 목표

> **전체 파일을 점검하여**
>
> 1. 문제점(버그·구조적 리스크)
> 2. 반드시 수정이 필요한 부분
> 3. 커스터마이징이 가능한 부분
>    을 분류·문서화하고
>    **중장기 진행 방향을 확정**한다.

이 단계는 **코드 수정이 아닌 "정밀 진단 + 설계 단계"**임.

---

## 2. 점검 범위 (전수 조사 대상)

### 2.1 파일 범위

* `/_branches/jp/` 전체

  * PHP (로직, 컨트롤러, 페이지)
  * CSS (페이지 단위, 공통)
  * JS (UI 제어, Ajax)
  * include / common 파일
* 언어 파일

  * `lang/ko.php`
  * `lang/ja.php`
  * `lang/en.php`
* DB 연동부

  * SQL 쿼리
  * 트랜잭션 처리
  * 상태 플래그 (chk 계열)

---

## 3. 분석 기준 (모든 AI 공통 룰)

### 3.1 문제점 (Problem)

다음 중 하나라도 해당하면 **문제점**으로 분류

* 상태값이 불명확하거나 중복됨
  (ex: `deposit_status`, `external_done_chk`, `settle_chk` 간 책임 불분명)
* UI와 실제 DB 상태가 어긋날 가능성
* Reject / Rollback 시 데이터 무결성 위험
* 언어 전환 시 텍스트 누락 또는 하드코딩
* 역할(GM/Admin/Master 등)에 따른 권한 분리 미흡
* 예외 처리 없이 진행되는 로직

➡️ **"지금 당장 안 터져도 언젠가 터질 수 있는 것" 포함**

---

### 3.2 수정 필요 (Required Fix)

아래에 해당하면 **반드시 수정 대상**

* 실제 운영 중 오류 발생 가능
* 데이터가 잘못 저장될 가능성
* 회계/정산/입금/출금 관련 논리 오류
* Reject 후 재처리 시 흐름이 불명확
* JP 기준 정책과 어긋난 부분

➡️ 이 항목은 **우선순위(P1~P3)** 로 나눔

---

### 3.3 커스터마이징 가능 (Customizable)

현재 구조를 유지하면서 **확장 또는 옵션화 가능한 영역**

예:

* UI 컴포넌트 재사용화
* 상태값 enum / 상수화
* 승인 플로우 단계화
* 권한별 버튼 노출 제어
* 로그 / 히스토리 강화
* 향후 다른 국가 브랜치 확장 고려 구조

➡️ **"지금 안 해도 되지만, 하면 강해지는 부분"**

---

## 4. 문서화 산출물 (필수)

다음 형태로 정리한다:

### 4.1 파일 단위 분석표

| 파일명 | 문제점 | 수정 필요 | 커스터마이징 | 비고 |
| --- | --- | ----- | ------ | -- |
| (예시) ok_save.php | 상태 플래그 중복 | tx_id NULL 처리 보완 | 로그 히스토리 강화 | P1 |
| (예시) country_ready.php | 언어 하드코딩 | status 필터 정규화 | 권한별 버튼 제어 | P2 |

### 4.2 공통 구조 이슈 요약

* 상태 관리
* 승인/Reject 흐름
* 언어 처리
* 권한 구조
* UI/UX 일관성

### 4.3 위험도 맵

* 🔴 즉시 수정 필요
* 🟡 추후 수정 권장
* 🟢 유지 가능

---

## 5. 진행 방식 (중요)

* **수정 절대 먼저 하지 않음**

* 반드시:

  1. 분석 →
  2. 문서 →
  3. 방향성 합의 →
  4. 수정 순서 결정 →
  5. 작업 착수

* 모든 AI는:

  * "이게 왜 위험한가"
  * "고치면 무엇이 좋아지는가"
  * "지금 안 고쳐도 되는 이유는 무엇인가"
    를 **의견 형태로 제시**

---

## 6. 다음 액션 제안 (선택)

👉 다음 중 하나를 선택해서 바로 진행 가능:

1. **A안**: 핵심 금융/정산/입금·출금 흐름부터 집중 분석
2. **B안**: UI/권한/언어 구조부터 전체 정리
3. **C안**: DB 상태값 & 플래그 체계 전면 분석
4. **D안**: 파일 단위 전수 조사부터 차근차근

---

## 7. 현재까지 완료된 작업 (참고)

### ✅ Country Ready/Completed 기능
- OK/Reject 버튼 DB 액션 수정 완료
- HIT 로깅 및 SQL 에러 처리 강화
- tx_id=NULL fallback 로직 구현
- Ready/Completed 페이지 상태 필터링 수정
- Japan region updated_at 컬럼 추가

### 📋 생성된 문서
- `DATABASE_SCHEMA_TEMPLATE.md` - 새 국가 추가 시 스키마 가이드
- `new_country_setup.sql` - CREATE TABLE 템플릿

### 🔒 확정 규칙
- Country 관련 영역은 추가 지시 전까지 수정 금지
- 단, 시스템 전체 영향 주는 에러만 예외 처리

---

이제 여기까지는 **완전히 정리 단계**입니다.
다음 메시지에서

> "A안으로 가자"
> 또는
> "D안부터 시작해"

처럼 지시 주시면,
**모든 AI가 같은 기준으로 분석 들어가겠습니다.**
